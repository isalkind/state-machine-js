!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.StateMachine=t()}}(function(){var t;return function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return r(n?n:e)},c,c.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(t,e,n){"use strict";function i(){this._states={},this._initial=null,this._currentState=null,this._previousState=null,this._cancelled=null,this._transitionComplete=!1,this._actionQueue=[],this._history=[],this._onChange=new r.Signal,this._onEnter=new r.Signal,this._onExit=new r.Signal}var r=t("signals");i.prototype={start:function(){if(!this._initial)throw"State Machine cannot start. No states defined.";return this._transitionTo(this._initial,null),this},action:function(t,e){if(!this._transitionComplete)return this._actionQueue.push({action:t,data:e}),this;var n=this._currentState.getTarget(t),i=this._states[n];return i&&this._transitionTo(i,e,t),this},_transitionTo:function(t,e,n){return this._transitionComplete=!1,this._cancelled=!1,this._currentState&&(this._currentState.onExit.dispatch(this._currentState,e,n),this._onExit.dispatch(this._currentState,e,n)),this._cancelled?(this._transitionComplete=!0,this._cancelled=!1,void this._processActionQueue()):(t.onEnter.dispatch(t,e,n),this._onEnter.dispatch(t,e,n),this._cancelled?(this._transitionComplete=!0,this._cancelled=!1,void this._processActionQueue()):(this._currentState&&(this._previousState=this._currentState,this._history.push(this._previousState.name)),this._currentState=t,t.onChange.dispatch(this._currentState,e,n),this._onChange.dispatch(this._currentState,e,n),this._transitionComplete=!0,void this._processActionQueue()))},_processActionQueue:function(){if(this._actionQueue.length>0){var t=this._actionQueue.shift();this._currentState.getTarget(t.action)?this.action(t.action,t.data):this._processActionQueue()}},cancel:function(){return this._cancelled=!0,this},_addState:function(t,e){return null===t||this._states[t.name]?null:(this._states[t.name]=t,e&&(this._initial=t),t)},removeState:function(t){var e=this._states[t];return null===e?null:(delete this._states[t],e)},getState:function(t){return this._states[t]},create:function(t){if(t instanceof Array)return t.forEach(function(t){this.create(t)},this),this;var e=new i.State(t.name),n=t.transitions;n&&n.forEach(function(n){e.addTransition(n.action,n.target),"function"==typeof t.onChange&&e.onChange.add(t.onChange),"function"==typeof t.onEnter&&e.onEnter.add(t.onEnter),"function"==typeof t.onExit&&e.onExit.add(t.onExit)});var r=0===this.getTotal()||t.initial;return this._addState(e,r),this},getTotal:function(){return Object.keys(this.states).length}},Object.defineProperty(i.prototype,"onChange",{get:function(){return this._onChange}}),Object.defineProperty(i.prototype,"onEnter",{get:function(){return this._onEnter}}),Object.defineProperty(i.prototype,"onExit",{get:function(){return this._onExit}}),Object.defineProperty(i.prototype,"currentState",{get:function(){return this._currentState}}),Object.defineProperty(i.prototype,"previousState",{get:function(){return this._previousState}}),Object.defineProperty(i.prototype,"states",{get:function(){return this._states}}),Object.defineProperty(i.prototype,"initial",{get:function(){return this._initial}}),Object.defineProperty(i.prototype,"history",{get:function(){return this._history}}),i.State=function(t){this._transitions={},this._name=t,this._onChange=new r.Signal,this._onEnter=new r.Signal,this._onExit=new r.Signal},i.State.prototype={addTransition:function(t,e){this.getTarget(t)||(this._transitions[t]=e)},removeTransition:function(t){this._transitions[t]=null},getTarget:function(t){return this._transitions[t]}},Object.defineProperty(i.State.prototype,"name",{get:function(){return this._name}}),Object.defineProperty(i.State.prototype,"transitions",{get:function(){return this._transitions}}),Object.defineProperty(i.State.prototype,"onChange",{get:function(){return this._onChange}}),Object.defineProperty(i.State.prototype,"onEnter",{get:function(){return this._onEnter}}),Object.defineProperty(i.State.prototype,"onExit",{get:function(){return this._onExit}}),i.DebugView=function(t){function e(t){for(var e=i.querySelectorAll("div"),n=0;n<e.length;n++)e[n].style.display=e[n].getAttribute("data-state")===t?"block":"none"}function n(e){var n=document.createElement("button");return n.setAttribute("data-action",e),n.addEventListener("click",function(){var e=this.getAttribute("data-action");t.action(e)}),n.innerHTML=e,n}var i=document.createElement("div");return Object.keys(t.states).forEach(function(e){var r=t.states[e],s=document.createElement("div");s.setAttribute("data-state",r.name),s.style.display="none";var o=document.createElement("h3");o.innerHTML="State: "+r.name,s.appendChild(o);var a=r.transitions;a&&Object.keys(a).forEach(function(t){a.hasOwnProperty(t)&&s.appendChild(n(t))}),i.appendChild(s)}),t.onChange.add(function(t){e(t.name)}),t.currentState&&e(t.currentState.name),i},e.exports=i},{signals:2}],2:[function(e,n,i){!function(e){function i(t,e,n,i,r){this._listener=e,this._isOnce=n,this.context=i,this._signal=t,this._priority=r||0}function r(t,e){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))}function s(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){s.prototype.dispatch.apply(t,arguments)}}i.prototype={active:!0,params:null,execute:function(t){var e,n;return this.active&&this._listener&&(n=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,n),this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},s.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(t,e,n,r){var s,o=this._indexOfListener(t,n);if(o!==-1){if(s=this._bindings[o],s.isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else s=new i(this,t,e,n,r),this._addBinding(s);return this.memorize&&this._prevParams&&s.execute(this._prevParams),s},_addBinding:function(t){var e=this._bindings.length;do--e;while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){for(var n,i=this._bindings.length;i--;)if(n=this._bindings[i],n._listener===t&&n.context===e)return i;return-1},has:function(t,e){return this._indexOfListener(t,e)!==-1},add:function(t,e,n){return r(t,"add"),this._registerListener(t,!1,e,n)},addOnce:function(t,e,n){return r(t,"addOnce"),this._registerListener(t,!0,e,n)},remove:function(t,e){r(t,"remove");var n=this._indexOfListener(t,e);return n!==-1&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),t},removeAll:function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(t){if(this.active){var e,n=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=n),i){e=this._bindings.slice(),this._shouldPropagate=!0;do i--;while(e[i]&&this._shouldPropagate&&e[i].execute(n)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var o=s;o.Signal=s,"function"==typeof t&&t.amd?t(function(){return o}):"undefined"!=typeof n&&n.exports?n.exports=o:e.signals=o}(this)},{}]},{},[1])(1)});